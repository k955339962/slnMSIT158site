
@{
    ViewData["Title"] = "Homework2";
}

<h1>作業2 縣市資料</h1>

<select id="selectCity">
    <option value="a">itme1</option>
</select>
<select id="selectDistricts">
    <option value="a">itme1</option>
</select>
<select id="selectRoads">
    <option value="a">itme1</option>
</select>
<span id="spanAddress"></span>
@section Styles{

}
@section Scripts{
    <script>
        const selCity = document.querySelector('#selectCity');
        const selDistricts = document.querySelector('#selectDistricts');
        const selRoads = document.querySelector('#selectRoads');
        const spnAddress = document.querySelector('#spanAddress');
        //載入鄉鎮區
        const loadDistricts = async () => {
            //console.log(selCity.value);
            //console.log(selCity.selectedIndex);
            //console.log(selCity.options[selCity.selectedIndex].value);
            //console.log(selCity.options[selCity.selectedIndex].text);



            const aa = selCity.options[selCity.selectedIndex].text;
            const url = `@Url.Content("~/api/districts")?p=${aa}`;

            const response = await fetch(url);
            const datas = await response.json();

            const districts = datas.map(district => `<option value="${district}">${district}</option>`);
            selDistricts.innerHTML = districts.join("");

            
        }
        //載入路名
        const loadRoads = async () => {
            const bb = selDistricts.options[selDistricts.selectedIndex].text;
            console.log(bb);
            const url = `@Url.Content("~/api/Roads")?districts=${bb}`;

            const response = await fetch(url);
            const datas = await response.json();

            const roads = datas.map(road => `<option value="${road}">${road}</option>`)
            selRoads.innerHTML = roads.join("");

            loadAddress();
        }

        const loadAddress = () => {
            spnAddress.textContent = `住址：${selDistricts.value}${selRoads.value}`;
        }


        //ajax
        (async () => {
            // 發送 GET 請求到指定的 API 路徑以獲取城市數據
            const response = await fetch('@Url.Content("~/api/cities")');
            // 等待並解析回應的 JSON 數據
            const data = await response.json();
            // 將數據映射為 <option> 元素的數組
            const cities = data.map((city, index, arr) => {
                //console.log(arr);
                // 返回每個城市對應的 <option> 元素
                return `<option value="${city}">${city}</option>`;
            })
            // 將生成的 <option> 元素設置為下拉選單的內部 HTML
            selCity.innerHTML = cities.join("");

            selCity.addEventListener('change', loadDistricts);
            await loadDistricts();
            await loadRoads();
            loadAddress();
        })();

        selCity.addEventListener('change', loadDistricts);
        selDistricts.addEventListener('change', loadRoads);
        selRoads.addEventListener('change', loadAddress);
    </script>
}